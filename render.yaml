# render.yaml
# Blueprint para desplegar n8n en Render.com (v4, validación final)
# Corrige el error de 'startCommand' en el servicio de Redis.

# 1. Definición de la Infraestructura de Base de Datos
databases:
  - name: n8n-postgres
    plan: free
    databaseName: n8n
    user: n8n_user

# 2. Definición de los Servicios de Aplicación
services:
  # Servicio de Redis (Corregido con runtime explícito)
  - type: pserv
    name: n8n-redis
    # CORRECCIÓN: Se añade 'runtime: docker' para satisfacer al validador.
    runtime: docker
    image:
      url: redis:7
    plan: free

  # Servicio Web Principal de n8n
  - type: web
    name: n8n
    runtime: docker
    repo: https://github.com/alfazeng/n8n.git
    branch: master
    autoDeploy: true
    dockerfilePath: ./docker/images/n8n/Dockerfile
    plan: free
    dockerCommand: "n8n"
    healthCheckPath: /healthz
    envVars:
      # --- Conexión a la Base de Datos Gestionada ---
      - key: DB_TYPE
        value: postgresdb
      - key: DB_POST<ctrl63>